Quasi-Resonant Mode Control Peripheral Configuration Example
============================================================

Introduction
=============
All hardware and microcontroller related settings are entered in file globals.h by entering physical 
values like frequencies in [Hz], time in [sec], voltages in [V] or duty ratios in [%].
Pre-compiler macros are used to translate these settings into integer numbers, which will be programmed
into the Special Function Registers (SFRs) during runtime.

This code example establishes a quasi-resonant mode feedback loop. Potentiometers P1 and P2 are used
to set the DAC reference level and to emulate the current feedback signal. 

ToDo: README file needs to be updated from here on forward

1) Test Pins Setup
===================

    - TP45: Main PWM Drive
    - TP42: Auxiliary PWM used for placing ADC triggers and as envelope frequency for the main PWM
            current limit logic input
    - TP41: High-Speed Comparator Output 
    - TP3:  DAC Output (showing reference voltage with compensation slope)
    - TP20: Reference voltage level => Jumper J5/J6 @ TP20 to connect pin to potentiometer P2
    - TP6:  High-Speed Comparator Feedback Input => Jumper J5/J6 @ TP6 to connect pin to potentiometer P1

    - TP34: Debug Pin indicating when a new value is written to DAC1DATH
    - TP36: Debug Pin indicating ADC ISR activity

2) Executing this Example
==========================

When programmed, the PWM will output a 400 kHz frequency with 80% on-time. P2 can be used to set the
DAC output level, the compensation ramp will be modulated on. P1 can be used to adjust the feedback 
level to comparator CMP1. Once the comparator trips, the PWM on-time will be truncated.

The slope is starting with a slew rate of 100mV/usec. This slew rate will increment by 100mV/usec 
each time switch button SW1 is pressed.


2) Peripheral Configuration and Utilization
============================================
The peripherals used to establish a peak-current mode feedback loop includes:

    - PG1:  PWM Generator driving the main switch of the SEPIC on pin PWM1H
    - PG2:  PWM Generator used as comparator acceptance filter during the main switch on-time
            and also providing the ADC trigger to sample the SEPIC output voltage
    - DAC/CMP1: DAC peripheral with high-speed analog comparator triggering the active on-time
            when the current sense signal crosses the reference voltage provided by the DAC
    - SLP1: Slope compensation ramp generated by the DAC preventing sub-harmonic oscillations
            when the converter is running in fixed frequency, continuous conduction mode
    - AN16: Analog input used to sample the converter output voltage via ADC core #2 (shared ADC core)
            Its Interrupt Service Routine (ISR) is also used to call the outer voltage loop of the 
            power supply controller, which has been disabled in this example.

    optional:
    ---------
    - AN6:  Used as external reference voltage input to allow adjustment of the converter reference
            voltage. In this example, this analog input has been re-routed to provide the reference
            level of the internal DAC1

3) Startup Adjustment
=====================
The startup procedure is taking place automatically. The startup behavior can be adjusted in three 
intervals:
                             _____________________
                            /
                           / |           |
                          /  |           |
                         /   |           |
                        /    |           |
                       /     |           |
   VOUT ______________/      |           |
        |             |      |           |
        |----PODLY----|-RPER-|---PGDLY---|-COMPLETE-

    PODLY: Power On Delay, specified in [sec] (e.g. 500e-3)
    RPER:  Ramp-Up Period, specified in [sec] (e.g. 50e-3)
    PGDLY: Power Good Delay, specified in [sec] (e.g. 100e-3)

After initializing the power controller and its peripherals, the power control state machine waits 
in status STANDBY until all fault flags have been cleared, ADC is running, the power controller
is enabled and the GO-bit has been set. If the option AUTO_STARTUP is set, the power controller 
is enabled and the GO-bit is set automatically and the startup procedure will be initiated immediately
without being triggered by a software command.

4) External Voltage Reference Input  (used for DAC reference level at P2)
====================================
Pin TP20 at header J3 can be used to inject an external reference voltage signal to manually
adjust the output voltage. The analog signal range is AVSS to AVDD (0 ... 3.3 V DC). 
These voltage rails should not be exceeded by more than 200 mV (e.g. AVSS - 0.2V or AVDD + 0.2 V) to
prevent undefined behavior or damages.

The external reference voltage signal is read directly by the Analog-To-Digital converter (ADC).
The sampled value is scaled as number between 0 ... 1 (0-100%).

    VREF_MAX _ _ _ _ ______________________________
                      |
                      |
                      |    ADJUSTABLE RANGE
                      |  (VREF_MAX - VREF_MIN)
                      |       (0 ... 100%)
                      |
    VREF_MIN _ _ _ _ _|____________________________

The limits VREF_MIN and VREF_MAX are set in file globals.h

    - VREF_MIN: Minimum output voltage level in [V] (e.g. V_REF_MINIMUM  0.5)
    - VREF_MAX: Maximum output voltage level in [V] (e.g. V_REF_MAXIMUM  3.0)
    


___________________________________________________
(c) 2019, Microchip Technology Inc.
